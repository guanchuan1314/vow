# Vow Security Rules
# These rules detect potential security issues and AI hallucinations

# Rust/Actix-specific security rules for issues #155-#179

- id: rust-sql-injection
  name: SQL Injection in Rust
  description: Detects potential SQL injection vulnerabilities in Rust code
  severity: high
  file_types:
    - rs
  patterns:
    - pattern_type: contains
      value: "format!(\"SELECT"
      message: "SQL injection risk - avoid using format! with user input in SQL queries"
    - pattern_type: contains
      value: "format!(\"INSERT"
      message: "SQL injection risk - avoid using format! with user input in SQL queries"
    - pattern_type: contains
      value: "format!(\"UPDATE"
      message: "SQL injection risk - avoid using format! with user input in SQL queries"
    - pattern_type: contains
      value: "format!(\"DELETE"
      message: "SQL injection risk - avoid using format! with user input in SQL queries"
    - pattern_type: contains
      value: "SELECT * FROM"
      message: "SQL injection risk - raw SQL query detected, ensure proper parameterization"
    - pattern_type: contains
      value: "INSERT INTO"
      message: "SQL injection risk - raw SQL query detected, ensure proper parameterization"
    - pattern_type: contains
      value: ".to_string() + &"
      message: "SQL injection risk - avoid string concatenation with user input for SQL"

- id: rust-xss
  name: Cross-Site Scripting in Rust
  description: Detects potential XSS vulnerabilities in Rust HTML generation
  severity: high
  file_types:
    - rs
  patterns:
    - pattern_type: contains
      value: "format!(\"<"
      message: "XSS risk - avoid using format! with user input in HTML templates"
    - pattern_type: contains
      value: ".content_type(\"text/html\")"
      message: "XSS risk - ensure user input is properly escaped when serving HTML"
    - pattern_type: contains
      value: "format!(\"<script"
      message: "XSS risk - embedding user data in script tags is dangerous"
    - pattern_type: contains
      value: ".to_string() + \"<"
      message: "XSS risk - avoid string concatenation with HTML tags"

- id: rust-command-injection
  name: Command Injection in Rust
  description: Detects potential command injection vulnerabilities in Rust
  severity: high
  file_types:
    - rs
  patterns:
    - pattern_type: contains
      value: "Command::new(\"sh\")"
      message: "Command injection risk - avoid executing shell commands with user input"
    - pattern_type: contains
      value: ".arg(\"-c\")"
      message: "Command injection risk - shell -c flag allows arbitrary command execution"
    - pattern_type: contains
      value: "Command::new(&"
      message: "Command injection risk - avoid dynamic command names from user input"
    - pattern_type: contains
      value: ".args(&["
      message: "Command injection risk - ensure command arguments are properly sanitized"

- id: rust-path-traversal
  name: Path Traversal in Rust
  description: Detects potential path traversal vulnerabilities in Rust
  severity: high
  file_types:
    - rs
  patterns:
    - pattern_type: contains
      value: "format!(\"/uploads/{}\""
      message: "Path traversal risk - validate file paths to prevent directory traversal"
    - pattern_type: contains
      value: "format!(\"./{}\"" 
      message: "Path traversal risk - avoid constructing file paths with user input"
    - pattern_type: contains
      value: ".to_string() + &"
      message: "Path traversal risk - avoid string concatenation for file paths"
    - pattern_type: contains
      value: "Path::new("
      message: "Path traversal risk - ensure path construction is safe from traversal attacks"

- id: rust-ssrf
  name: Server-Side Request Forgery in Rust  
  description: Detects potential SSRF vulnerabilities in Rust HTTP requests
  severity: high
  file_types:
    - rs
  patterns:
    - pattern_type: contains
      value: "reqwest::get(&"
      message: "SSRF risk - validate URLs before making HTTP requests"
    - pattern_type: contains
      value: ".get(&url)"
      message: "SSRF risk - ensure URL validation before external requests"
    - pattern_type: contains
      value: ".post(&"
      message: "SSRF risk - validate destination URLs in HTTP requests"
    - pattern_type: contains
      value: "format!(\"http://"
      message: "SSRF risk - avoid constructing URLs with user input"

- id: rust-hardcoded-secrets
  name: Hardcoded Secrets in Rust
  description: Detects hardcoded API keys, passwords, and secrets in Rust code
  severity: high
  file_types:
    - rs
  patterns:
    - pattern_type: contains
      value: "const API_KEY"
      message: "Hardcoded API key detected - use environment variables instead"
    - pattern_type: contains
      value: "const SECRET"
      message: "Hardcoded secret detected - use secure configuration management"
    - pattern_type: contains
      value: "DATABASE_PASSWORD"
      message: "Hardcoded database password detected - use environment variables"
    - pattern_type: contains
      value: "JWT_SECRET"
      message: "Hardcoded JWT secret detected - use secure key management"
    - pattern_type: contains
      value: "sk-"
      message: "Hardcoded API key pattern detected (sk- prefix commonly used for secrets)"
    - pattern_type: contains
      value: "AKIA"
      message: "Hardcoded AWS access key detected"

- id: rust-csrf
  name: CSRF Vulnerability in Rust/Actix
  description: Detects missing CSRF protection in state-changing endpoints
  severity: medium
  file_types:
    - rs
  patterns:
    - pattern_type: contains
      value: "pub async fn delete_"
      message: "CSRF risk - DELETE endpoints should have CSRF protection"
    - pattern_type: contains
      value: "pub async fn update_"
      message: "CSRF risk - UPDATE endpoints should have CSRF protection"
    - pattern_type: contains
      value: "transfer_money"
      message: "CSRF risk - financial operations must have CSRF protection"
    - pattern_type: contains
      value: "change_password"
      message: "CSRF risk - password changes must have CSRF protection"

- id: rust-unsafe-memory
  name: Unsafe Memory Operations in Rust
  description: Detects potentially dangerous unsafe memory operations
  severity: high
  file_types:
    - rs
  patterns:
    - pattern_type: contains
      value: "Box::from_raw(ptr)"
      message: "Memory safety risk - potential use after free or double free"
    - pattern_type: contains
      value: ".offset("
      message: "Memory safety risk - pointer arithmetic can cause buffer overflows"
    - pattern_type: contains
      value: "assume_init()"
      message: "Memory safety risk - using uninitialized memory"
    - pattern_type: contains
      value: "transmute("
      message: "Memory safety risk - transmute can cause type confusion"
    - pattern_type: contains
      value: "static mut"
      message: "Memory safety risk - global mutable state can cause race conditions"

- id: rust-integer-overflow
  name: Integer Overflow in Rust
  description: Detects potential integer overflow vulnerabilities
  severity: medium
  file_types:
    - rs
  patterns:
    - pattern_type: contains
      value: "wrapping_add("
      message: "Integer overflow risk - consider using checked arithmetic operations"
    - pattern_type: contains
      value: "as u8"
      message: "Integer overflow risk - casting to smaller integer types can truncate values"
    - pattern_type: contains
      value: "255 + 1"
      message: "Integer overflow risk - arithmetic near type limits"

- id: rust-weak-crypto
  name: Weak Cryptography in Rust
  description: Detects use of weak or deprecated cryptographic functions
  severity: medium  
  file_types:
    - rs
  patterns:
    - pattern_type: contains
      value: "md5::"
      message: "Weak cryptography - MD5 is cryptographically broken"
    - pattern_type: contains
      value: "sha1::"
      message: "Weak cryptography - SHA1 is deprecated for security use"
    - pattern_type: contains
      value: "rand::random()"
      message: "Weak randomness - use cryptographically secure random number generation"

- id: rust-insecure-deserialization
  name: Insecure Deserialization in Rust
  description: Detects potentially unsafe deserialization patterns and improper input validation
  severity: medium
  file_types:
    - rs
  patterns:
    - pattern_type: contains
      value: "bincode::deserialize("
      message: "Deserialization risk - validate data before deserializing binary formats"
    - pattern_type: contains
      value: "ron::from_str("
      message: "Deserialization risk - validate RON input to prevent injection"
    - pattern_type: contains
      value: "serde_json::from_str(&"
      message: "Deserialization risk - validate JSON input structure and size limits"
    - pattern_type: contains
      value: "web::Json<"
      message: "Improper input validation - ensure deserialized user input is properly validated"
    - pattern_type: contains
      value: "web::Form<"
      message: "Improper input validation - validate form input before processing"
    - pattern_type: contains
      value: "web::Query<"
      message: "Improper input validation - validate query parameters before use"
    - pattern_type: contains
      value: "#[serde(skip_serializing_if"
      message: "Input validation risk - conditional serialization may expose internal state"
    - pattern_type: contains
      value: "serde_json::from_slice("
      message: "Improper input validation - validate byte input before deserialization"
    - pattern_type: contains
      value: "from_str(&request_body)"
      message: "Improper input validation - no validation on deserialized user input"
    - pattern_type: contains
      value: "toml::from_str("
      message: "Deserialization risk - validate TOML input to prevent malformed data processing"

- id: rust-race-conditions
  name: Race Conditions in Rust
  description: Detects potential race condition vulnerabilities
  severity: medium
  file_types:
    - rs
  patterns:
    - pattern_type: contains
      value: "RefCell::new("
      message: "Concurrency risk - RefCell is not thread-safe, use Mutex for shared state"
    - pattern_type: contains
      value: "Cell::new("
      message: "Concurrency risk - Cell is not thread-safe for complex operations"
    - pattern_type: contains
      value: "unsafe { COUNTER"
      message: "Race condition risk - global mutable state without synchronization"

- id: rust-weak-authentication  
  name: Weak Authentication in Rust
  description: Detects weak authentication patterns in Rust/Actix applications
  severity: high
  file_types:
    - rs
  patterns:
    - pattern_type: contains
      value: "password == \""
      message: "Weak authentication - avoid plain text password comparison"
    - pattern_type: contains
      value: "if token.is_empty()"
      message: "Weak authentication - insufficient token validation"
    - pattern_type: contains 
      value: "admin_check"
      message: "Authentication bypass risk - ensure proper admin authorization"

- id: rust-jwt-weakness
  name: JWT Security Issues in Rust
  description: Detects potential JWT implementation weaknesses
  severity: medium
  file_types:
    - rs
  patterns:
    - pattern_type: contains
      value: "Algorithm::None"
      message: "JWT vulnerability - 'none' algorithm allows unsigned tokens"
    - pattern_type: contains
      value: "decode_header("
      message: "JWT risk - ensure proper signature verification"
    - pattern_type: contains
      value: "jwt::encode("
      message: "JWT risk - ensure secure key management and algorithm choice"

- id: rust-xxe
  name: XML External Entity (XXE) in Rust
  description: Detects potential XXE vulnerabilities in XML processing
  severity: high
  file_types:
    - rs
  patterns:
    - pattern_type: contains
      value: "quick_xml::"
      message: "XXE risk - ensure XML parser disables external entity processing"
    - pattern_type: contains
      value: "xmlparser::"
      message: "XXE risk - configure XML parser to prevent external entity attacks"
    - pattern_type: contains
      value: "from_str(&xml"
      message: "XXE risk - validate XML input and disable external entities"

- id: rust-xml-injection
  name: XML Injection in Rust
  description: Detects XML injection where user input is interpolated into XML response bodies
  severity: high
  file_types:
    - rs
  patterns:
    - pattern_type: contains
      value: "format!(\"<{}\""
      message: "XML injection - user input interpolated directly into XML tags"
    - pattern_type: contains
      value: "format!(\"<?xml"
      message: "XML injection - user input in XML declaration or processing instructions"
    - pattern_type: contains
      value: ".content_type(\"application/xml\")"
      message: "XML injection risk - ensure XML response content is properly escaped"
    - pattern_type: contains
      value: "format!(\"<response>{}</response>\""
      message: "XML injection - user input directly embedded in XML response body"
    - pattern_type: contains
      value: "&user_input + \"</"
      message: "XML injection - string concatenation with XML tags and user input"
    - pattern_type: contains
      value: "to_string() + \"<"
      message: "XML injection - user input concatenated with XML markup"

- id: rust-nosql-injection
  name: NoSQL Injection in Rust
  description: Detects NoSQL injection where user input is used in format!() to build database query filters
  severity: high
  file_types:
    - rs
  patterns:
    - pattern_type: contains
      value: "format!(\"{{"
      message: "NoSQL injection - user input used in format!() to build query filters"
    - pattern_type: contains
      value: "format!(\"{{$"
      message: "NoSQL injection - user input in MongoDB-style query operators"
    - pattern_type: contains
      value: "format!(\"find({{\"name\": \"{}\"}}\""
      message: "NoSQL injection - user input directly interpolated into NoSQL query"
    - pattern_type: contains
      value: "format!(\"{{\\\"$where\\\": \\\"this.{}\""
      message: "NoSQL injection - user input in $where clauses can execute arbitrary JavaScript"
    - pattern_type: contains
      value: "format!(\"{{\\\"$regex\\\": \\\"{}\""
      message: "NoSQL injection - user input in regex operators without escaping"
    - pattern_type: contains
      value: ".find(format!(\"{{\"username\": \"{}\"}}\""
      message: "NoSQL injection - format!() used to build database query with user input"
    - pattern_type: contains
      value: "format!(\"{{\\\"_id\\\": \\\"{}\"}}\""
      message: "NoSQL injection - user input used to build ObjectId queries"
    - pattern_type: contains
      value: "format!(\"{{\\\"$or\\\": ["
      message: "NoSQL injection - user input in $or operator construction"

- id: rust-graphql-injection
  name: GraphQL Injection in Rust
  description: Detects GraphQL injection where unsanitized input is used in GraphQL resolvers
  severity: high
  file_types:
    - rs
  patterns:
    - pattern_type: contains
      value: "format!(\"query {{"
      message: "GraphQL injection - unsanitized input in GraphQL query construction"
    - pattern_type: contains
      value: "format!(\"mutation {{"
      message: "GraphQL injection - unsanitized input in GraphQL mutation construction"
    - pattern_type: contains
      value: "format!(\"{{\\\"query\\\": \\\"query"
      message: "GraphQL injection - user input directly embedded in GraphQL query string"
    - pattern_type: contains
      value: "user_input + \"}\""
      message: "GraphQL injection - string concatenation with GraphQL query parts"
    - pattern_type: contains
      value: "format!(\"user(id: {})\""
      message: "GraphQL injection - unsanitized input in GraphQL field arguments"
    - pattern_type: contains
      value: ".execute(&format!(\"{"
      message: "GraphQL injection - dynamic GraphQL query execution with user input"
    - pattern_type: contains
      value: "graphql::execute("
      message: "GraphQL injection risk - ensure proper input validation in GraphQL resolvers"
    - pattern_type: contains
      value: "async_graphql::Object"
      message: "GraphQL injection risk - validate all inputs in GraphQL resolvers"

- id: rust-open-redirect  
  name: Open Redirect in Rust
  description: Detects potential open redirect vulnerabilities
  severity: medium
  file_types:
    - rs
  patterns:
    - pattern_type: contains
      value: "HttpResponse::Found()"
      message: "Open redirect risk - validate redirect URLs against whitelist"
    - pattern_type: contains
      value: ".header(\"Location\","
      message: "Open redirect risk - ensure redirect destinations are validated"
    - pattern_type: contains
      value: "redirect_to"
      message: "Open redirect risk - validate redirect parameter"
    - pattern_type: contains
      value: ".header(\"Location\", &"
      message: "Unvalidated redirect - user input passed directly to Location header without validation"
    - pattern_type: contains
      value: "format!(\"Location: {}\""
      message: "Unvalidated redirect - user input in Location header format string"
    - pattern_type: contains
      value: "HttpResponse::PermanentRedirect().header(\"Location\", url"
      message: "Unvalidated redirect - ensure URL validation before redirect"

- id: rust-mass-assignment
  name: Mass Assignment in Rust
  description: Detects potential mass assignment vulnerabilities
  severity: medium
  file_types:
    - rs
  patterns:
    - pattern_type: contains
      value: "serde(flatten)"
      message: "Mass assignment risk - flattened deserialization can allow unintended field updates"
    - pattern_type: contains
      value: "web::Json<"
      message: "Mass assignment risk - ensure JSON input validation and field restrictions"
    - pattern_type: contains
      value: "#[serde(default)]"
      message: "Mass assignment risk - default values may expose internal fields"

- id: rust-idor
  name: Insecure Direct Object Reference (IDOR) in Rust
  description: Detects potential IDOR vulnerabilities
  severity: medium
  file_types:
    - rs
  patterns:
    - pattern_type: contains
      value: "web::Path<u32>"
      message: "IDOR risk - ensure authorization checks before accessing resources by ID"
    - pattern_type: contains
      value: "get_user_by_id("
      message: "IDOR risk - verify user has permission to access requested resource"
    - pattern_type: contains
      value: "/users/{id}"
      message: "IDOR risk - implement proper access control for resource endpoints"

- id: rust-missing-rate-limiting
  name: Missing Rate Limiting in Rust/Actix
  description: Detects endpoints that may need rate limiting
  severity: low
  file_types:
    - rs
  patterns:
    - pattern_type: contains
      value: "pub async fn login("
      message: "Rate limiting needed - login endpoints should have rate limiting"
    - pattern_type: contains
      value: "pub async fn register("
      message: "Rate limiting needed - registration endpoints should have rate limiting"
    - pattern_type: contains
      value: "pub async fn forgot_password("
      message: "Rate limiting needed - password reset endpoints should have rate limiting"

- id: rust-insufficient-logging
  name: Insufficient Security Logging in Rust
  description: Detects security-sensitive operations without logging
  severity: low
  file_types:
    - rs
  patterns:
    - pattern_type: contains
      value: "delete_user("
      message: "Logging needed - security-sensitive operations should be logged"
    - pattern_type: contains
      value: "admin_action("
      message: "Logging needed - administrative actions should be logged"
    - pattern_type: contains
      value: "privilege_escalation"
      message: "Logging needed - privilege changes should be logged"

- id: rust-improper-error-handling
  name: Improper Error Handling in Rust
  description: Detects potentially unsafe error handling patterns
  severity: low
  file_types:
    - rs
  patterns:
    - pattern_type: contains
      value: ".unwrap()"
      message: "Error handling risk - unwrap() can cause panics, use proper error handling"
    - pattern_type: contains
      value: ".expect(\"Failed"
      message: "Error handling risk - expect() can expose sensitive information in panics"
    - pattern_type: contains
      value: "panic!(\"Error:"
      message: "Error handling risk - panic messages may expose sensitive information"

- id: rust-memory-leak
  name: Memory Leak Risk in Rust
  description: Detects patterns that may cause memory leaks
  severity: medium
  file_types:
    - rs
  patterns:
    - pattern_type: contains
      value: "Box::leak("
      message: "Memory leak risk - leaked memory is never freed"
    - pattern_type: contains
      value: "forget("
      message: "Memory leak risk - mem::forget prevents cleanup"
    - pattern_type: contains
      value: "into_raw("
      message: "Memory leak risk - ensure raw pointers are properly managed"

- id: rust-null-pointer-dereference
  name: Null Pointer Dereference in Rust
  description: Detects potential null pointer dereferences in unsafe code
  severity: high
  file_types:
    - rs
  patterns:
    - pattern_type: contains
      value: "*ptr"
      message: "Null pointer risk - ensure pointer validity before dereferencing"
    - pattern_type: contains
      value: "as_mut().unwrap()"
      message: "Null pointer risk - unsafe pointer conversion without null check"
    - pattern_type: contains
      value: "NonNull::new_unchecked("
      message: "Null pointer risk - unchecked pointer creation can lead to null dereference"

- id: rust-deadlock
  name: Deadlock Risk in Rust
  description: Detects potential deadlock patterns in concurrent code
  severity: medium
  file_types:
    - rs
  patterns:
    - pattern_type: contains
      value: ".lock().unwrap()"
      message: "Deadlock risk - multiple locks can cause deadlocks, ensure consistent lock ordering"
    - pattern_type: contains
      value: "RwLock::write("
      message: "Deadlock risk - write locks can cause deadlocks with other locks"
    - pattern_type: contains
      value: "Mutex::lock("
      message: "Deadlock risk - ensure proper lock ordering to prevent deadlocks"

- id: rust-uncontrolled-recursion
  name: Uncontrolled Recursion in Rust
  description: Detects recursive functions without depth limits
  severity: medium
  file_types:
    - rs
  patterns:
    - pattern_type: contains
      value: "fn recursive_"
      message: "Stack overflow risk - implement recursion depth limits"
    - pattern_type: contains
      value: "self.process(self"
      message: "Stack overflow risk - recursive calls without depth checking"

- id: rust-http-request-smuggling
  name: HTTP Request Smuggling in Rust
  description: Detects potential HTTP request smuggling vulnerabilities
  severity: high
  file_types:
    - rs
  patterns:
    - pattern_type: contains
      value: "Content-Length:"
      message: "HTTP smuggling risk - ensure proper header validation"
    - pattern_type: contains
      value: "Transfer-Encoding:"
      message: "HTTP smuggling risk - validate transfer encoding headers"

- id: rust-websocket-hijacking
  name: WebSocket Hijacking in Rust
  description: Detects WebSocket endpoints without proper origin validation
  severity: medium
  file_types:
    - rs
  patterns:
    - pattern_type: contains
      value: "actix_web_actors::ws"
      message: "WebSocket security risk - implement origin validation and authentication"
    - pattern_type: contains
      value: "ws::start("
      message: "WebSocket security risk - ensure proper authentication and origin checks"

- id: rust-oauth-misconfiguration
  name: OAuth Misconfiguration in Rust
  description: Detects potential OAuth implementation issues
  severity: medium
  file_types:
    - rs
  patterns:
    - pattern_type: contains
      value: "oauth2::"
      message: "OAuth security risk - ensure proper state validation and PKCE implementation"
    - pattern_type: contains
      value: "redirect_uri"
      message: "OAuth security risk - validate redirect URIs against whitelist"

- id: rust-dos-resource-exhaustion
  name: DoS via Resource Exhaustion in Rust
  description: Detects patterns that could lead to resource exhaustion
  severity: medium
  file_types:
    - rs
  patterns:
    - pattern_type: contains
      value: "Vec::with_capacity("
      message: "DoS risk - validate capacity limits to prevent memory exhaustion"
    - pattern_type: contains
      value: "HashMap::new()"
      message: "DoS risk - consider size limits for user-controlled collections"
    - pattern_type: contains
      value: "loop {"
      message: "DoS risk - ensure loops have termination conditions and limits"

# C#/ASP.NET-specific security rules for issues #215-#239

- id: csharp-sql-injection
  name: SQL Injection in C#
  description: Detects potential SQL injection vulnerabilities in C# code
  severity: high
  file_types:
    - cs
  patterns:
    - pattern_type: contains
      value: "string.Format(\"SELECT"
      message: "SQL injection risk - avoid string formatting with user input in SQL queries"
    - pattern_type: contains
      value: "\"SELECT * FROM \" +"
      message: "SQL injection risk - avoid string concatenation with user input for SQL"
    - pattern_type: contains
      value: "$\"SELECT"
      message: "SQL injection risk - avoid string interpolation with user input in SQL queries"
    - pattern_type: contains
      value: "CommandText ="
      message: "SQL injection risk - use parameterized queries instead of dynamic SQL"
    - pattern_type: contains
      value: ".ExecuteScalar(\"SELECT"
      message: "SQL injection risk - use parameterized queries"
    - pattern_type: contains
      value: ".Query<"
      message: "SQL injection risk - ensure Dapper queries use parameters, not string concatenation"

- id: csharp-xss
  name: Cross-Site Scripting in C#
  description: Detects potential XSS vulnerabilities in C# web applications
  severity: high
  file_types:
    - cs
    - aspx
    - cshtml
  patterns:
    - pattern_type: contains
      value: "@Html.Raw("
      message: "XSS risk - Raw HTML output bypasses encoding, validate and sanitize input"
    - pattern_type: contains
      value: "innerHTML ="
      message: "XSS risk - setting innerHTML with user data can execute scripts"
    - pattern_type: contains
      value: "Response.Write("
      message: "XSS risk - ensure user input is properly encoded before output"
    - pattern_type: contains
      value: "<%="
      message: "XSS risk - classic ASP.NET output without encoding"
    - pattern_type: contains
      value: ".InnerHtml ="
      message: "XSS risk - setting InnerHtml can execute malicious scripts"

- id: csharp-xxe
  name: XML External Entity (XXE) in C#
  description: Detects potential XXE vulnerabilities in XML processing
  severity: high
  file_types:
    - cs
  patterns:
    - pattern_type: contains
      value: "XmlDocument("
      message: "XXE risk - XmlDocument enables external entities by default, disable DTD processing"
    - pattern_type: contains
      value: "XmlReader.Create("
      message: "XXE risk - configure XmlReaderSettings to disable external entity processing"
    - pattern_type: contains
      value: "XPathDocument("
      message: "XXE risk - XPathDocument may process external entities, use safe settings"
    - pattern_type: contains
      value: "XmlSerializer("
      message: "XXE risk - ensure XML input is validated and external entities are disabled"

- id: csharp-xml-injection
  name: XML Injection in C#
  description: Detects XML injection where user input is interpolated into XML
  severity: high
  file_types:
    - cs
  patterns:
    - pattern_type: contains
      value: "string.Format(\"<{0}>\""
      message: "XML injection - user input directly interpolated into XML elements"
    - pattern_type: contains
      value: "$\"<{user"
      message: "XML injection - string interpolation with user input in XML tags"
    - pattern_type: contains
      value: "\"<response>\" + user"
      message: "XML injection - string concatenation with XML tags and user input"
    - pattern_type: contains
      value: ".InnerXml ="
      message: "XML injection risk - setting InnerXml with user input can inject malicious XML"

- id: csharp-crlf-injection
  name: CRLF Injection in C#
  description: Detects CRLF injection in HTTP headers
  severity: medium
  file_types:
    - cs
  patterns:
    - pattern_type: contains
      value: "Response.AddHeader("
      message: "CRLF injection risk - validate header values to prevent header injection"
    - pattern_type: contains
      value: "Response.Headers.Add("
      message: "CRLF injection risk - ensure header values don't contain CRLF characters"
    - pattern_type: contains
      value: "HttpContext.Response.Headers["
      message: "CRLF injection risk - sanitize header values to prevent response splitting"

- id: csharp-ssrf
  name: Server-Side Request Forgery in C#
  description: Detects potential SSRF vulnerabilities in C# HTTP requests
  severity: high
  file_types:
    - cs
  patterns:
    - pattern_type: contains
      value: "HttpClient.GetAsync("
      message: "SSRF risk - validate URLs before making HTTP requests"
    - pattern_type: contains
      value: "WebRequest.Create("
      message: "SSRF risk - ensure URL validation before external requests"
    - pattern_type: contains
      value: "HttpWebRequest("
      message: "SSRF risk - validate destination URLs to prevent internal network access"
    - pattern_type: contains
      value: "RestClient("
      message: "SSRF risk - validate base URLs and endpoints before requests"

- id: csharp-open-redirect
  name: Open Redirect in C#
  description: Detects potential open redirect and unvalidated redirect vulnerabilities
  severity: medium
  file_types:
    - cs
  patterns:
    - pattern_type: contains
      value: "Response.Redirect("
      message: "Open redirect risk - validate redirect URLs against whitelist"
    - pattern_type: contains
      value: "Redirect(returnUrl"
      message: "Unvalidated redirect - ensure returnUrl parameter is validated"
    - pattern_type: contains
      value: "RedirectToAction(url"
      message: "Unvalidated redirect - validate URL parameter before redirect"
    - pattern_type: contains
      value: "RedirectResult("
      message: "Open redirect risk - ensure redirect destination is validated"

- id: csharp-csrf
  name: CSRF Vulnerability in C#
  description: Detects missing CSRF protection in state-changing actions
  severity: medium
  file_types:
    - cs
  patterns:
    - pattern_type: contains
      value: "[HttpPost]"
      message: "CSRF risk - POST actions should have [ValidateAntiForgeryToken] attribute"
    - pattern_type: contains
      value: "[HttpDelete]"
      message: "CSRF risk - DELETE actions should have CSRF protection"
    - pattern_type: contains
      value: "[HttpPut]"
      message: "CSRF risk - PUT actions should have CSRF protection"
    - pattern_type: contains
      value: "public ActionResult Delete"
      message: "CSRF risk - state-changing actions need anti-forgery token validation"

- id: csharp-hardcoded-secrets
  name: Hardcoded Secrets in C#
  description: Detects hardcoded API keys, passwords, and secrets in C# code
  severity: high
  file_types:
    - cs
    - config
  patterns:
    - pattern_type: contains
      value: "const string API_KEY"
      message: "Hardcoded API key detected - use configuration or environment variables"
    - pattern_type: contains
      value: "private string password = \""
      message: "Hardcoded password detected - use secure configuration management"
    - pattern_type: contains
      value: "ConnectionString = \"Server="
      message: "Hardcoded connection string detected - use configuration files"
    - pattern_type: contains
      value: "static readonly string SECRET"
      message: "Hardcoded secret detected - use secure key management"

- id: csharp-weak-cryptography
  name: Weak Cryptography in C#
  description: Detects use of weak or deprecated cryptographic functions
  severity: medium
  file_types:
    - cs
  patterns:
    - pattern_type: contains
      value: "MD5.Create()"
      message: "Weak cryptography - MD5 is cryptographically broken, use SHA256 or better"
    - pattern_type: contains
      value: "SHA1.Create()"
      message: "Weak cryptography - SHA1 is deprecated for security use"
    - pattern_type: contains
      value: "DESCryptoServiceProvider"
      message: "Weak cryptography - DES encryption is insecure, use AES"
    - pattern_type: contains
      value: "RC2CryptoServiceProvider"
      message: "Weak cryptography - RC2 is vulnerable, use AES encryption"
    - pattern_type: contains
      value: "new Random()"
      message: "Weak randomness - use RNGCryptoServiceProvider for cryptographic operations"

- id: csharp-weak-authentication
  name: Weak Authentication in C#
  description: Detects weak authentication patterns in C# applications
  severity: high
  file_types:
    - cs
  patterns:
    - pattern_type: contains
      value: "password == request.Password"
      message: "Weak authentication - avoid plain text password comparison"
    - pattern_type: contains
      value: "FormsAuthentication.SetAuthCookie("
      message: "Weak authentication - ensure proper password verification before authentication"
    - pattern_type: contains
      value: "User.Identity.IsAuthenticated"
      message: "Authentication bypass risk - ensure proper authorization checks"
    - pattern_type: contains
      value: "if (token.Length > 0)"
      message: "Weak authentication - insufficient token validation"

- id: csharp-insecure-deserialization
  name: Insecure Deserialization in C#
  description: Detects potentially unsafe deserialization patterns
  severity: high
  file_types:
    - cs
  patterns:
    - pattern_type: contains
      value: "BinaryFormatter"
      message: "Insecure deserialization - BinaryFormatter is unsafe, use safe alternatives"
    - pattern_type: contains
      value: "JavaScriptSerializer"
      message: "Deserialization risk - ensure type validation with JavaScriptSerializer"
    - pattern_type: contains
      value: "XmlSerializer.Deserialize("
      message: "Deserialization risk - validate XML input before deserialization"
    - pattern_type: contains
      value: "JsonConvert.DeserializeObject<object>("
      message: "Insecure deserialization - deserializing to object allows arbitrary types"

- id: csharp-unsafe-reflection
  name: Unsafe Reflection in C#
  description: Detects potentially dangerous reflection operations
  severity: medium
  file_types:
    - cs
  patterns:
    - pattern_type: contains
      value: "Type.GetType(userInput"
      message: "Unsafe reflection - user input used to load types can execute arbitrary code"
    - pattern_type: contains
      value: "Assembly.LoadFrom("
      message: "Unsafe reflection - loading assemblies from user paths is dangerous"
    - pattern_type: contains
      value: "Activator.CreateInstance("
      message: "Unsafe reflection - ensure type validation before object instantiation"
    - pattern_type: contains
      value: "MethodInfo.Invoke("
      message: "Unsafe reflection - validate methods before dynamic invocation"

- id: csharp-insecure-file-permissions
  name: Insecure File Permissions in C#
  description: Detects insecure file permission settings
  severity: medium
  file_types:
    - cs
  patterns:
    - pattern_type: contains
      value: "FileAccess.ReadWrite"
      message: "File permission risk - ensure minimal necessary file permissions"
    - pattern_type: contains
      value: "File.Create("
      message: "File permission risk - validate file paths and set appropriate permissions"
    - pattern_type: contains
      value: "Directory.CreateDirectory("
      message: "File permission risk - ensure secure directory permissions"
    - pattern_type: contains
      value: "FileSystemRights.FullControl"
      message: "Insecure file permissions - FullControl grants excessive permissions"

- id: csharp-unrestricted-file-upload
  name: Unrestricted File Upload in C#
  description: Detects unrestricted file upload vulnerabilities
  severity: high
  file_types:
    - cs
  patterns:
    - pattern_type: contains
      value: "SaveAs("
      message: "File upload risk - validate file type, size, and name before saving"
    - pattern_type: contains
      value: "HttpPostedFile"
      message: "File upload risk - implement file type and size validation"
    - pattern_type: contains
      value: "IFormFile"
      message: "File upload risk - validate uploaded files before processing"
    - pattern_type: contains
      value: "File.WriteAllBytes("
      message: "File upload risk - ensure file content validation and secure storage"

- id: csharp-buffer-overflow
  name: Buffer Overflow in C#
  description: Detects potential buffer overflow vulnerabilities in unsafe code
  severity: high
  file_types:
    - cs
  patterns:
    - pattern_type: contains
      value: "fixed ("
      message: "Buffer overflow risk - ensure bounds checking in fixed buffer operations"
    - pattern_type: contains
      value: "Marshal.Copy("
      message: "Buffer overflow risk - validate array bounds in Marshal operations"
    - pattern_type: contains
      value: "unsafe {"
      message: "Buffer overflow risk - unsafe code requires careful memory management"
    - pattern_type: contains
      value: "stackalloc"
      message: "Buffer overflow risk - validate allocation size in stack allocation"

- id: csharp-race-condition
  name: Race Condition in C#
  description: Detects potential race condition vulnerabilities
  severity: medium
  file_types:
    - cs
  patterns:
    - pattern_type: contains
      value: "static int counter"
      message: "Race condition risk - static variables need thread synchronization"
    - pattern_type: contains
      value: "if (Instance == null)"
      message: "Race condition risk - singleton pattern needs thread-safe initialization"
    - pattern_type: contains
      value: "++counter"
      message: "Race condition risk - increment operations need atomic operations or locking"
    - pattern_type: contains
      value: "Dictionary<"
      message: "Race condition risk - generic collections are not thread-safe"

- id: csharp-integer-overflow
  name: Integer Overflow in C#
  description: Detects potential integer overflow vulnerabilities
  severity: medium
  file_types:
    - cs
  patterns:
    - pattern_type: contains
      value: "int.MaxValue + 1"
      message: "Integer overflow risk - arithmetic near type limits can overflow"
    - pattern_type: contains
      value: "(byte)intValue"
      message: "Integer overflow risk - casting to smaller types can lose data"
    - pattern_type: contains
      value: "unchecked("
      message: "Integer overflow risk - unchecked arithmetic ignores overflow exceptions"
    - pattern_type: contains
      value: "Convert.ToInt32("
      message: "Integer overflow risk - validate input ranges before conversion"

- id: csharp-memory-leak
  name: Memory Leak Risk in C#
  description: Detects patterns that may cause memory leaks
  severity: medium
  file_types:
    - cs
  patterns:
    - pattern_type: contains
      value: "event +="
      message: "Memory leak risk - ensure event handlers are properly unsubscribed"
    - pattern_type: contains
      value: "Timer("
      message: "Memory leak risk - dispose timers to prevent memory leaks"
    - pattern_type: contains
      value: "FileStream"
      message: "Memory leak risk - ensure streams are properly disposed using 'using' statements"
    - pattern_type: contains
      value: "GC.SuppressFinalize"
      message: "Memory leak risk - incorrect finalization can cause memory leaks"

- id: csharp-null-pointer-dereference
  name: Null Pointer Dereference in C#
  description: Detects potential null reference exceptions
  severity: medium
  file_types:
    - cs
  patterns:
    - pattern_type: contains
      value: ".Value)"
      message: "Null reference risk - check nullable values before accessing .Value"
    - pattern_type: contains
      value: "as string)"
      message: "Null reference risk - cast operations can return null, add null checks"
    - pattern_type: contains
      value: ".First()"
      message: "Null reference risk - use FirstOrDefault() and check for null"
    - pattern_type: contains
      value: "[0]"
      message: "Null reference risk - validate array/collection before accessing elements"

- id: csharp-deadlock
  name: Deadlock Risk in C#
  description: Detects potential deadlock patterns in concurrent code
  severity: medium
  file_types:
    - cs
  patterns:
    - pattern_type: contains
      value: "lock (lock1)"
      message: "Deadlock risk - multiple locks can cause deadlocks, ensure consistent lock ordering"
    - pattern_type: contains
      value: ".Result"
      message: "Deadlock risk - .Result on async operations can cause deadlocks"
    - pattern_type: contains
      value: ".Wait()"
      message: "Deadlock risk - .Wait() on async operations can cause deadlocks in UI contexts"
    - pattern_type: contains
      value: "Monitor.Enter("
      message: "Deadlock risk - ensure Monitor.Exit is called in finally block"

- id: csharp-uncontrolled-recursion
  name: Uncontrolled Recursion in C#
  description: Detects recursive methods without depth limits
  severity: medium
  file_types:
    - cs
  patterns:
    - pattern_type: contains
      value: "public void Recursive"
      message: "Stack overflow risk - implement recursion depth limits"
    - pattern_type: contains
      value: "return Recursive("
      message: "Stack overflow risk - recursive calls without depth checking can cause stack overflow"
    - pattern_type: contains
      value: "this.Process(this"
      message: "Stack overflow risk - self-recursive calls need depth control"

- id: csharp-insufficient-logging
  name: Insufficient Security Logging in C#
  description: Detects security-sensitive operations without logging
  severity: low
  file_types:
    - cs
  patterns:
    - pattern_type: contains
      value: "public ActionResult DeleteUser("
      message: "Logging needed - user deletion should be logged for security auditing"
    - pattern_type: contains
      value: "RoleManager.AddToRole("
      message: "Logging needed - role changes should be logged"
    - pattern_type: contains
      value: "FormsAuthentication.SignOut("
      message: "Logging needed - logout events should be logged"
    - pattern_type: contains
      value: "[Authorize(Roles = \"Admin\")]"
      message: "Logging needed - admin actions should be logged"

- id: csharp-improper-error-handling
  name: Improper Error Handling in C#
  description: Detects potentially unsafe error handling patterns
  severity: low
  file_types:
    - cs
  patterns:
    - pattern_type: contains
      value: "catch (Exception ex)"
      message: "Error handling risk - catching generic Exception can hide specific errors"
    - pattern_type: contains
      value: "throw ex"
      message: "Error handling risk - 'throw ex' loses stack trace, use 'throw' instead"
    - pattern_type: contains
      value: "Response.Write(ex.Message)"
      message: "Error handling risk - exposing exception details can leak sensitive information"
    - pattern_type: contains
      value: "catch { }"
      message: "Error handling risk - empty catch blocks hide errors"

- id: dangerous-eval
  name: Dangerous eval() Usage  
  description: Detects potentially dangerous eval() function calls
  severity: high
  file_types:
    - py
    - js
  patterns:
    - pattern_type: contains
      value: "eval("
      message: "Use of eval() detected - this can lead to code injection vulnerabilities"

- id: system-calls
  name: System Command Execution
  description: Detects system command execution that may be unsafe
  severity: medium
  file_types:
    - py
  patterns:
    - pattern_type: contains
      value: "subprocess.call"
      message: "System call detected - ensure input is properly sanitized"
    - pattern_type: contains
      value: "os.system"
      message: "Direct system call detected - consider safer alternatives"

- id: hardcoded-secrets
  name: Hardcoded Secrets
  description: Detects potential hardcoded API keys or secrets
  severity: high
  file_types:
    - py
    - js
    - ts
    - yaml
    - json
  patterns:
    - pattern_type: contains
      value: "API_KEY"
      message: "Potential hardcoded API key detected"
    - pattern_type: contains
      value: "SECRET_KEY"
      message: "Potential hardcoded secret key detected"
    - pattern_type: contains
      value: "password ="
      message: "Potential hardcoded password detected"

- id: ai-markers
  name: AI Content Markers
  description: Detects content that appears to be AI-generated
  severity: low
  patterns:
    - pattern_type: contains
      value: "As an AI"
      message: "AI-generated content marker detected"
    - pattern_type: contains
      value: "I don't have access"
      message: "AI limitation statement detected"
    - pattern_type: contains
      value: "I cannot"
      message: "AI refusal pattern detected"

- id: placeholder-content
  name: Placeholder Content
  description: Detects incomplete or placeholder content
  severity: low
  patterns:
    - pattern_type: contains
      value: "TODO"
      message: "TODO marker found - content may be incomplete"
    - pattern_type: contains
      value: "FIXME"
      message: "FIXME marker found - known issue exists"
    - pattern_type: contains
      value: "PLACEHOLDER"
      message: "Placeholder text detected"

- id: sql-injection
  name: SQL Injection Risk
  description: Detects potential SQL injection vulnerabilities
  severity: high
  file_types:
    - py
    - js
    - php
  patterns:
    - pattern_type: contains
      value: "SELECT * FROM"
      message: "Raw SQL query detected - use parameterized queries"
    - pattern_type: contains
      value: "INSERT INTO"
      message: "Raw SQL insert detected - ensure proper sanitization"