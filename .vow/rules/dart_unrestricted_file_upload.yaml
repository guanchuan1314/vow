name: "dart_unrestricted_file_upload"
description: "Detect unrestricted file upload vulnerabilities in Dart/Flutter with no file type or size validation"
severity: "high"
patterns:
  - type: "contains"
    pattern: "FilePicker.platform.pickFiles("
  - type: "contains"
    pattern: "ImagePicker().pickImage("
  - type: "contains"
    pattern: "file_picker"
  - type: "regex"
    pattern: "pickFiles\\([^)]*\\)(?!.*allowedExtensions)"
  - type: "regex"
    pattern: "pickImage\\([^)]*\\)(?!.*maxWidth)"
  - type: "regex"
    pattern: "pickFiles\\([^)]*\\)(?!.*type:)"
  - type: "contains"
    pattern: "type: FileType.any"
  - type: "contains"
    pattern: "allowMultiple: true"
  - type: "regex"
    pattern: "MultipartFile\\.fromPath\\([^)]*\\)(?!.*contentType)"
  - type: "contains"
    pattern: "FormData()"
  - type: "regex"
    pattern: "File\\([^)]*\\)\\.readAsBytesSync\\(\\)(?!.*length)"
  - type: "contains"
    pattern: "// No file validation"
  - type: "contains"
    pattern: "// TODO: Add file type check"
  - type: "contains"
    pattern: "// TODO: Add file size limit"
  - type: "regex"
    pattern: "uploadFile\\([^)]*\\)(?!.*validate)"
file_types: ["dart"]
fix_suggestion: "Add file type validation using allowedExtensions, implement file size limits, validate file content headers, sanitize filenames, and restrict upload locations. Never trust client-side validation alone."