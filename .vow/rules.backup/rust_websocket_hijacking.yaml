name: "rust_websocket_hijacking"
description: "Detect potential WebSocket hijacking vulnerabilities in Rust/Actix applications"
severity: "high"
patterns:
  - type: "regex"
    pattern: "actix_web_actors::ws::start\\([^)]*\\)(?!.*auth|.*verify)"
  - type: "regex"
    pattern: "ws::WebsocketContext[^.]*\\.text\\([^)]*\\)(?!.*sanitize|.*validate)"
  - type: "regex"
    pattern: "impl\\s+StreamHandler<[^>]*ws::[^>]*>\\s+for[^{]*\\{[^{}]*(?!.*auth)"
  - type: "contains"
    pattern: "ws::Message::Text"
  - type: "regex"
    pattern: "ws::start\\([^,]*,[^)]*\\)(?!.*token|.*auth)"
  - type: "regex"
    pattern: "WebSocket[^.]*\\.on_message\\([^{]*\\{[^{}]*(?!.*origin|.*csrf)"
  - type: "contains"
    pattern: "Sec-WebSocket-Protocol"
  - type: "regex"
    pattern: "HttpRequest[^.]*\\.headers\\(\\)(?!.*origin)"
  - type: "contains"
    pattern: "// TODO: add WebSocket auth"
  - type: "contains"
    pattern: "// FIXME: missing origin check"
  - type: "regex"
    pattern: "ws::[^(]*\\([^)]*\\)(?!.*validate|.*check)"
file_types: ["rs"]