name: "rust_missing_content_security_policy"
description: "Detect missing Content Security Policy headers in Rust/Actix web applications"
severity: "medium"
patterns:
  - type: "regex"
    pattern: "HttpResponse::(Ok|BadRequest|InternalServerError)\\(\\)\\s*\\.body\\([^)]*\\)(?!.*Content-Security-Policy)"
  - type: "regex"
    pattern: "HttpResponse::(Ok|BadRequest|InternalServerError)\\(\\)\\s*\\.json\\([^)]*\\)(?!.*Content-Security-Policy)"
  - type: "regex"
    pattern: "HttpResponse::build\\([^)]*\\)[^.]*\\.body\\([^)]*\\)(?!.*Content-Security-Policy)"
  - type: "regex"
    pattern: "web::Html\\([^)]*\\)(?!.*Content-Security-Policy)"
  - type: "regex"
    pattern: "\\.content_type\\([\"']text/html[\"']\\)(?!.*Content-Security-Policy)"
  - type: "regex"
    pattern: "actix_web::middleware::DefaultHeaders::new\\(\\)(?!.*Content-Security-Policy)"
  - type: "contains"
    pattern: "HttpResponse::Ok().content_type(\"text/html\")"
  - type: "contains"
    pattern: ".insert_header((\"Content-Type\", \"text/html\"))"
file_types: ["rs"]