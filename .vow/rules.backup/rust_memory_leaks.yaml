name: "rust_memory_leaks"
description: "Detect potential memory leak patterns in Rust code"
severity: "medium"
patterns:
  - type: "contains"
    pattern: "Box::leak("
  - type: "contains"
    pattern: "mem::forget("
  - type: "contains"
    pattern: "ManuallyDrop::new("
  - type: "regex"
    pattern: "unsafe\\s*\\{[^{}]*alloc::[^{}]*\\}(?!.*dealloc)"
  - type: "regex"
    pattern: "Vec::from_raw_parts\\([^)]*\\)(?!.*drop)"
  - type: "regex"
    pattern: "String::from_raw_parts\\([^)]*\\)(?!.*drop)"
  - type: "contains"
    pattern: "std::mem::transmute("
  - type: "regex"
    pattern: "Rc::new\\([^)]*\\)[^;]*(?!.*drop)"
  - type: "regex"
    pattern: "Arc::new\\([^)]*\\)[^;]*(?!.*drop)"
  - type: "contains"
    pattern: ".into_raw("
  - type: "contains"
    pattern: "// TODO: fix memory leak"
  - type: "contains"
    pattern: "// FIXME: memory not freed"
  - type: "regex"
    pattern: "static\\s+mut\\s+[^:]*:\\s*[^=]*=.*(?!.*drop)"
file_types: ["rs"]