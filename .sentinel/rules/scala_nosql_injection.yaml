name: "scala_nosql_injection"
description: "Detect potential NoSQL injection vulnerabilities in Scala/Play code"
severity: "high"
patterns:
  # MongoDB injection patterns
  - type: "contains"
    pattern: "find(Json.obj("
  - type: "contains"
    pattern: "find(s\"{\"$"
  - type: "contains"
    pattern: "findOne(Json.obj("
  - type: "contains"
    pattern: "findOne(s\"{\"$"
  - type: "contains"
    pattern: "update(Json.obj("
  - type: "contains"
    pattern: "update(s\"{\"$"
  - type: "contains"
    pattern: "remove(Json.obj("
  - type: "contains"
    pattern: "remove(s\"{\"$"
  - type: "contains"
    pattern: "aggregate(Json.obj("
  - type: "contains"
    pattern: "aggregate(s\"{\"$"
  - type: "contains"
    pattern: "insert(Json.obj("
  - type: "contains"
    pattern: "insert(s\"{\"$"
  
  # Reactive Mongo patterns
  - type: "contains"
    pattern: "collection.find(document(\""
  - type: "contains"
    pattern: "collection.find(s\"{\""
  - type: "contains"
    pattern: "BSONDocument(s\""
  - type: "contains"
    pattern: 'BSONDocument(".*" + '
  
  # CouchDB patterns
  - type: "contains"
    pattern: "view(s\""
  - type: "contains"
    pattern: "keys.*Array("
  - type: "contains"
    pattern: "startkey.*s\""
  - type: "contains"
    pattern: "endkey.*s\""
  
  # DynamoDB patterns
  - type: "contains"
    pattern: "scan.*FilterExpression.*s\""
  - type: "contains"
    pattern: "query.*KeyConditionExpression.*s\""
  - type: "contains"
    pattern: "AttributeValue.*S.*s\""
  - type: "contains"
    pattern: "ExpressionAttributeValues.*s\""
  
  # Generic NoSQL patterns
  - type: "contains"
    pattern: "$where.*s\""
  - type: "contains"
    pattern: "$regex.*s\""
  - type: "contains"
    pattern: "$eval.*s\""
  - type: "contains"
    pattern: "mapReduce.*s\""
file_types: ["scala"]