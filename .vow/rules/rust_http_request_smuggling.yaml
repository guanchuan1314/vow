name: "rust_http_request_smuggling"
description: "Detect potential HTTP request smuggling vulnerabilities in Rust/Actix applications"
severity: "high"
patterns:
  - type: "regex"
    pattern: "HttpRequest[^.]*\\.headers\\(\\)[^.]*\\.get\\([^)]*content-length[^)]*\\)"
  - type: "regex"
    pattern: "HttpRequest[^.]*\\.headers\\(\\)[^.]*\\.get\\([^)]*transfer-encoding[^)]*\\)"
  - type: "contains"
    pattern: "Content-Length"
  - type: "contains"
    pattern: "Transfer-Encoding"
  - type: "regex"
    pattern: "\\.header\\([^,]*\"Content-Length\"[^)]*\\)"
  - type: "regex"
    pattern: "\\.header\\([^,]*\"Transfer-Encoding\"[^)]*\\)"
  - type: "regex"
    pattern: "HttpResponse::[^(]*\\([^)]*\\)\\.header\\([^)]*\\)\\.header\\([^)]*\\)"
  - type: "contains"
    pattern: "chunked"
  - type: "regex"
    pattern: "req\\.headers\\(\\)[^.]*get\\([^)]*\\)(?!.*validate|.*check)"
  - type: "contains"
    pattern: "// TODO: validate headers"
  - type: "contains"
    pattern: "// FIXME: request smuggling"
  - type: "regex"
    pattern: "async\\s+fn[^{]*\\{[^{}]*headers[^{}]*(?!.*validate)"
file_types: ["rs"]