name: "rust_insufficient_auth"
description: "Detect insufficient authentication and authorization in Rust/Actix web applications"
severity: "high"
patterns:
  - type: "regex"
    pattern: "#\\[actix_web::(post|put|delete)\\([^)]*\\)]\\s*async\\s+fn\\s+[^(]*\\([^)]*\\)\\s*->\\s*[^{]*\\{(?!.*auth)"
  - type: "regex"
    pattern: "#\\[(post|put|delete)\\([^)]*\\)]\\s*async\\s+fn\\s+[^(]*\\([^)]*\\)\\s*->\\s*[^{]*\\{(?!.*auth)"
  - type: "regex"
    pattern: "web::resource\\([^)]*admin[^)]*\\)[^.]*\\.route\\([^)]*\\)(?!.*auth)"
  - type: "regex"
    pattern: "web::resource\\([^)]*api[^)]*\\)[^.]*\\.route\\([^)]*\\)(?!.*auth)" 
  - type: "contains"
    pattern: "// TODO: add authentication"
  - type: "contains"
    pattern: "// FIXME: missing auth check"
  - type: "regex"
    pattern: "async\\s+fn\\s+delete_[^(]*\\([^)]*\\)\\s*->\\s*[^{]*\\{(?!.*auth|.*permission)"
  - type: "regex"
    pattern: "async\\s+fn\\s+admin_[^(]*\\([^)]*\\)\\s*->\\s*[^{]*\\{(?!.*auth|.*permission)"
  - type: "contains"
    pattern: "HttpRequest"
  - type: "contains"
    pattern: ".cookie("
file_types: ["rs"]