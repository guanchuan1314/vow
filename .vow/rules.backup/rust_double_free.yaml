name: "rust_double_free"
description: "Detect potential double-free vulnerabilities in unsafe Rust code"
severity: "critical"
patterns:
  - type: "regex"
    pattern: "unsafe\\s*\\{[^}]*drop\\([^)]*\\)[^}]*drop\\([^)]*\\)[^}]*\\}"
  - type: "regex"
    pattern: "Box::from_raw\\([^)]*\\)[^;]*;[^;]*Box::from_raw\\([^)]*\\)"
  - type: "regex"
    pattern: "dealloc\\([^)]*\\)[^;]*;[^;]*dealloc\\([^)]*\\)"
  - type: "regex"
    pattern: "Global\\.dealloc\\([^)]*\\)"
  - type: "regex"
    pattern: "std::alloc::dealloc\\([^)]*\\)"
  - type: "regex"
    pattern: "ptr::drop_in_place\\([^)]*\\)[^;]*;[^;]*ptr::drop_in_place\\([^)]*\\)"
  - type: "regex"
    pattern: "ManuallyDrop::drop\\([^)]*\\)[^;]*;[^;]*ManuallyDrop::drop\\([^)]*\\)"
file_types: ["rs"]