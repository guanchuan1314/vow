name: "dart_uncontrolled_recursion"
description: "Detect uncontrolled recursion in Dart/Flutter, particularly widgets calling themselves without base cases"
severity: "medium"
patterns:
  - type: "regex"
    pattern: "class\\s+(\\w+Widget)\\s+extends\\s+.*\\{[^}]*\\1\\([^}]*\\}[^}]*\\}"
  - type: "regex"
    pattern: "Widget\\s+build\\([^)]*\\)\\s*\\{[^}]*return\\s+\\w+\\([^}]*\\}"
  - type: "regex"
    pattern: "build\\([^)]*\\)\\s*\\{[^}]*\\w+\\([^}]*\\}(?!.*if\\s*\\()"
  - type: "contains"
    pattern: "return MyWidget("
  - type: "contains"
    pattern: "return CustomWidget("
  - type: "regex"
    pattern: "return\\s+(\\w+)\\((?!.*if\\s*\\()[^}]*\\}.*class\\s+\\1"
  - type: "regex"
    pattern: "(\\w+)\\(\\)\\s*\\{[^}]*return\\s+\\1\\("
  - type: "regex"
    pattern: "void\\s+(\\w+)\\([^)]*\\)\\s*\\{[^}]*\\1\\("
  - type: "contains"
    pattern: "// TODO: Add base case"
  - type: "contains"
    pattern: "// Infinite recursion risk"
  - type: "regex"
    pattern: "function\\s+(\\w+)\\([^)]*\\)\\s*\\{[^}]*\\1\\([^}]*\\}(?!.*return)"
  - type: "contains"
    pattern: "StatefulWidget"
  - type: "contains"
    pattern: "StatelessWidget"
file_types: ["dart"]
fix_suggestion: "Add proper base cases to recursive functions and widgets. Implement depth limits, condition checks, or use iterative approaches. Ensure recursive widgets have proper termination conditions."