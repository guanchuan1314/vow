name: "rust_uncontrolled_recursion"
description: "Detect uncontrolled recursion patterns that could lead to stack overflow"
severity: "high"
patterns:
  - type: "regex"
    pattern: "fn\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s*\\([^{]*\\{[^{}]*\\1\\s*\\("
  - type: "regex"
    pattern: "async\\s+fn\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s*\\([^{]*\\{[^{}]*\\1\\s*\\("
  - type: "regex"
    pattern: "fn\\s+[^{]*\\{[^{}]*(?!.*depth|.*limit|.*max).*self\\s*\\("
  - type: "regex"
    pattern: "impl[^{]*\\{[^{}]*fn\\s+[^{]*\\{[^{}]*(?!.*depth|.*limit).*self\\."
  - type: "contains"
    pattern: "recursive_call("
  - type: "contains"
    pattern: ".recursively("
  - type: "regex"
    pattern: "fn\\s+parse[^{]*\\{[^{}]*(?!.*depth|.*max).*parse\\s*\\("
  - type: "regex"
    pattern: "fn\\s+eval[^{]*\\{[^{}]*(?!.*depth|.*max).*eval\\s*\\("
  - type: "contains"
    pattern: "// TODO: add recursion limit"
  - type: "contains"
    pattern: "// FIXME: unbounded recursion"
  - type: "regex"
    pattern: "fn\\s+process[^{]*\\{[^{}]*(?!.*count|.*limit|.*depth).*process\\s*\\("
file_types: ["rs"]