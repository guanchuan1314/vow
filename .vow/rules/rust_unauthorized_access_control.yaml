name: "rust_unauthorized_access_control"
description: "Detect unauthorized access control vulnerabilities in Rust/Actix web applications"
severity: "high"
patterns:
  - type: "regex"
    pattern: "web::resource\\([^)]*\\)[^.]*\\.route\\(web::(get|post|put|delete)\\(\\)\\)(?!.*guard)"
  - type: "regex"
    pattern: "#\\[actix_web::(get|post|put|delete)\\([^)]*\\)]\\s*async\\s+fn\\s+[^(]*\\([^)]*req:\\s*HttpRequest"
  - type: "contains"
    pattern: "// BYPASS: skip auth check"
  - type: "contains"
    pattern: "// TODO: implement access control"
  - type: "regex"
    pattern: "if\\s+[^{]*user_id\\s*==\\s*[^{]*\\{[^}]*return\\s+Ok"
  - type: "regex"
    pattern: "match\\s+user\\.role\\s*\\{[^}]*_\\s*=>\\s*Ok\\("
  - type: "regex"
    pattern: "HttpResponse::Ok\\(\\)[^;]*(?!.*check_permission|.*authorize)"
  - type: "regex"
    pattern: "\\.extract::<Identity>\\([^)]*\\)[^.]*\\.is_none\\(\\)\\s*\\{[^}]*continue"
  - type: "contains"
    pattern: ".cookie(\"admin\").is_some()"
  - type: "regex"
    pattern: "req\\.headers\\(\\)\\.get\\([\"']authorization[\"']\\)[^.]*\\.is_some\\(\\)"
file_types: ["rs"]