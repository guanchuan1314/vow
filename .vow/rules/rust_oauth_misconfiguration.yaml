name: "rust_oauth_misconfiguration"
description: "Detect OAuth misconfiguration issues in Rust applications"
severity: "high"
patterns:
  - type: "contains"
    pattern: "redirect_uri"
  - type: "regex"
    pattern: "oauth[^.]*\\.redirect_uri\\([^)]*http://[^)]*\\)"
  - type: "regex"
    pattern: "client_secret\\s*=\\s*\"[^\"]*\""
  - type: "contains"
    pattern: "state"
  - type: "regex"
    pattern: "authorize_url\\([^)]*\\)(?!.*state)"
  - type: "regex"
    pattern: "OAuth[^.]*\\.callback\\([^{]*\\{[^{}]*(?!.*csrf|.*state)"
  - type: "contains"
    pattern: "scope=*"
  - type: "contains"
    pattern: "response_type=code"
  - type: "regex"
    pattern: "access_token\\([^)]*\\)(?!.*expire|.*validate)"
  - type: "contains"
    pattern: "// TODO: add CSRF protection"
  - type: "contains"
    pattern: "// FIXME: missing state parameter"
  - type: "regex"
    pattern: "env::var\\([^)]*CLIENT_SECRET[^)]*\\)\\.unwrap_or\\([^)]*\"[^\"]*\""
file_types: ["rs"]