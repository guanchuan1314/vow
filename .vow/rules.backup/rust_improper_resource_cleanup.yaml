name: "rust_improper_resource_cleanup"
description: "Detect improper resource cleanup patterns in Rust code"
severity: "medium"
patterns:
  - type: "regex"
    pattern: "File::open\\([^)]*\\)(?!.*drop|.*std::mem::forget)"
  - type: "regex"
    pattern: "TcpStream::connect\\([^)]*\\)(?!.*drop|.*shutdown)"
  - type: "regex"
    pattern: "std::process::Command::new\\([^)]*\\)[^.]*\\.spawn\\(\\)(?!.*wait|.*kill)"
  - type: "regex"
    pattern: "thread::spawn("
  - type: "regex"
    pattern: "Box::leak\\("
  - type: "regex"
    pattern: "std::mem::forget\\("
  - type: "regex"
    pattern: "ManuallyDrop::new\\("
  - type: "regex"
    pattern: "unsafe\\s*\\{[^}]*Box::from_raw[^}]*\\}(?!.*drop)"
  - type: "regex"
    pattern: "std::ptr::read\\([^)]*\\)(?!.*drop)"
  - type: "regex"
    pattern: "Connection::connect\\([^)]*\\)(?!.*close|.*disconnect)"
  - type: "contains"
    pattern: "// TODO: cleanup resources"
  - type: "contains"
    pattern: "// FIXME: resource leak"
file_types: ["rs"]