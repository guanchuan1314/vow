name: "scala_sql_injection"
description: "Detect potential SQL injection vulnerabilities including blind and second-order SQL injection in Scala/Play code"
severity: "high"
patterns:
  # Basic SQL injection patterns
  - type: "contains"
    pattern: "s\"SELECT $"
  - type: "contains"
    pattern: "s\"INSERT INTO $"
  - type: "contains"
    pattern: "s\"UPDATE $"
  - type: "contains"
    pattern: "s\"DELETE FROM $"
  - type: "contains"
    pattern: '"SELECT " + '
  - type: "contains"
    pattern: '"INSERT INTO " + '
  - type: "contains"
    pattern: '"UPDATE " + '
  - type: "contains"
    pattern: '"DELETE FROM " + '
  - type: "contains"
    pattern: "Statement.execute(\""
  - type: "contains"
    pattern: "createStatement().execute"
  - type: "contains"
    pattern: "SQL(\"SELECT"
  - type: "contains"
    pattern: "SQL(s\"SELECT"
  - type: "contains"
    pattern: "DB.withConnection { implicit c => SQL(\""
  
  # Blind SQL injection patterns
  - type: "contains"
    pattern: "s\"SELECT CASE WHEN"
  - type: "contains"
    pattern: "s\"SELECT COUNT(*) FROM $"
  - type: "contains"
    pattern: "s\"SELECT 1 WHERE $"
  - type: "contains"
    pattern: "waitfor delay"
  - type: "contains"
    pattern: "SLEEP($"
  - type: "contains"
    pattern: "BENCHMARK($"
  - type: "contains"
    pattern: "pg_sleep($"
  - type: "contains"
    pattern: "extractvalue("
  - type: "contains"
    pattern: "updatexml("
  
  # Second-order SQL injection patterns (stored data used in queries)
  - type: "contains"
    pattern: "fromRequest.*SQL"
  - type: "contains"
    pattern: "session.get.*s\"SELECT"
  - type: "contains"
    pattern: "cache.get.*SQL"
  - type: "contains"
    pattern: "database.save.*SQL"
  - type: "contains"
    pattern: "user.name.*s\"SELECT"
  - type: "contains"
    pattern: "user.input.*SQL"
  - type: "contains"
    pattern: "stored.*s\"SELECT"
file_types: ["scala"]