name: "rust_deadlocks"
description: "Detect potential deadlock patterns in Rust/Actix applications"
severity: "high"
patterns:
  - type: "regex"
    pattern: "Mutex::new\\([^)]*\\)[^;]*;[^{}]*Mutex::new\\([^)]*\\)"
  - type: "regex"
    pattern: "\\.lock\\(\\)\\.unwrap\\([^}]*\\.lock\\(\\)\\.unwrap\\("
  - type: "regex"
    pattern: "Arc<Mutex<[^>]*>>[^;]*Arc<Mutex<[^>]*>>"
  - type: "regex"
    pattern: "\\.lock\\(\\)[^}]*\\.await[^}]*\\.lock\\(\\)"
  - type: "contains"
    pattern: "mutex1.lock().unwrap();"
  - type: "contains"
    pattern: "mutex2.lock().unwrap();"
  - type: "regex"
    pattern: "RwLock::new\\([^)]*\\)[^;]*;[^{}]*RwLock::new\\([^)]*\\)"
  - type: "regex"
    pattern: "\\.write\\(\\)\\.unwrap\\([^}]*\\.write\\(\\)\\.unwrap\\("
  - type: "regex"
    pattern: "async\\s+fn\\s+[^{]*\\{[^{}]*\\.lock\\(\\)[^{}]*\\.await[^{}]*\\.lock\\(\\)"
  - type: "contains"
    pattern: "// TODO: fix deadlock"
  - type: "contains"
    pattern: "// FIXME: potential deadlock"
file_types: ["rs"]