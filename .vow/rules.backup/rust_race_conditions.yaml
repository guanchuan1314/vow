name: "rust_race_conditions"
description: "Detect potential race condition vulnerabilities in Rust concurrent code"
severity: "high"
patterns:
  - type: "regex"
    pattern: "static\\s+mut\\s+\\w+:"
  - type: "regex"
    pattern: "unsafe\\s*\\{[^}]*GLOBAL_[^}]*\\}"
  - type: "regex"
    pattern: "Rc<RefCell<[^>]*>>"
  - type: "regex"
    pattern: "std::sync::Mutex::new\\([^)]*\\)[^;]*;[^;]*unsafe"
  - type: "regex"
    pattern: "Arc<Mutex<[^>]*>>[^;]*;[^;]*unsafe"
  - type: "regex"
    pattern: "static\\s+[^:]+:\\s*[^=]*=\\s*[^;]*;"
  - type: "regex"
    pattern: "lazy_static!\\s*\\{[^}]*static\\s+mut[^}]*\\}"
  - type: "regex"
    pattern: "thread::spawn\\([^)]*\\)[^;]*;[^;]*unsafe"
file_types: ["rs"]