name: "rust_concurrent_access_violations"
description: "Detect concurrent access violations and race conditions in Rust code"
severity: "high"
patterns:
  - type: "regex"
    pattern: "static\\s+mut\\s+[^:]+:"
  - type: "regex"
    pattern: "unsafe\\s*\\{[^}]*static\\s+mut"
  - type: "regex"
    pattern: "std::sync::Mutex::new\\([^)]*\\)\\s*\\.lock\\(\\)\\s*\\.unwrap\\(\\)"
  - type: "regex"
    pattern: "Arc::new\\([^)]*\\)\\s*\\.clone\\(\\)"
  - type: "regex"
    pattern: "\\.lock\\(\\)\\s*\\.unwrap\\(\\)[^;]*\\n[^\\n]*\\.lock\\(\\)\\s*\\.unwrap\\(\\)"
  - type: "contains"
    pattern: "std::sync::RwLock"
  - type: "regex"
    pattern: "unsafe\\s*\\{[^}]*\\*mut"
  - type: "regex"
    pattern: "UnsafeCell::get\\("
  - type: "contains"
    pattern: "std::ptr::write_volatile"
  - type: "contains"
    pattern: "std::sync::atomic::Ordering::Relaxed"
  - type: "regex"
    pattern: "thread::spawn("
file_types: ["rs"]