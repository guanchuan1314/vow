name: "rust_use_after_free"
description: "Detect potential use-after-free vulnerabilities in unsafe Rust code"
severity: "critical"
patterns:
  - type: "regex"
    pattern: "unsafe\\s*\\{[^}]*Box::from_raw[^}]*\\}"
  - type: "regex"
    pattern: "unsafe\\s*\\{[^}]*\\*[^}]*after[^}]*drop[^}]*\\}"
  - type: "regex"
    pattern: "Box::from_raw\\([^)]*\\)"
  - type: "regex"
    pattern: "Rc::from_raw\\([^)]*\\)"
  - type: "regex"
    pattern: "Arc::from_raw\\([^)]*\\)"
  - type: "regex"
    pattern: "ManuallyDrop::drop\\([^)]*\\)"
  - type: "regex"
    pattern: "ptr::drop_in_place\\([^)]*\\)"
  - type: "regex"
    pattern: "forget\\([^)]*\\)"
  - type: "regex"
    pattern: "unsafe\\s*\\{[^}]*drop\\([^)]*\\)[^}]*\\*[^}]*\\}"
file_types: ["rs"]